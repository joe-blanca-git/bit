<div class="income">
  <div class="header mb-4">
    <div class="row w-100">
      <div class="col-6">
        <div class="breadcrumb d-none d-sm-block">
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><span>FINANCEIRO</span></li>
              <li class="breadcrumb-item active"><span>RECEITAS</span></li>
            </ol>
          </nav>
        </div>
      </div>
      <div class="col-6 d-lg-flex justify-content-end gap-2 d-none">
        <button class="btn btn-outline-primary" (click)="newFinancialMovStatusChange()">
          <i class="fa fa-plus"></i>&nbsp;<span>Nova Receita</span>
        </button>
        <button class="btn btn-outline-primary">
          <i class="fa fa-file-pdf"></i>&nbsp;<span>Exportar</span>
        </button>
      </div>
    </div>
    <div class="title text-success">
      <i class="fa-solid fa-circle-dollar-to-slot text-success"></i>
      {{ title }}
    </div>
    <div class="description">{{ description }}</div>
  </div>

  <div class="content">
    <div class="cards-dash">
      <div class="row">
        <div class="col-6 col-md-4 col-lg-3 pb-2 flex-shrink-0" *ngFor="let item of dashboardCards">
          <div class="card" [ngClass]="item.bg">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-9 d-flex flex-column align-items-start">
                  <span class="h6">{{ item.title }}</span>
                  <span>{{ item.value | format: "currency" }}</span>
                </div>
                <div class="col-3">
                  <i class="fa-xl" [ngClass]="item.icon"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-3">
        <div class="col-12 mb-2 col-md-4 col-lg-4 d-flex align-items-start justify-content-end flex-column">
          <label class="text-secondary text-smaller">Pesquisar</label>
          <input nz-input placeholder="Filtrar na lista..." (input)="onSearch($event)" />
        </div>
        <div class="col-12 mb-2 col-md-4 col-lg-3 d-flex align-items-start justify-content-end flex-column">
          <label class="text-secondary text-smaller">Lançamento</label>
          <nz-range-picker 
            class="w-100" 
            [(ngModel)]="dateRange" 
            [nzRanges]="ranges" 
            (ngModelChange)="loadData()" 
            nzFormat="dd/MM/yyyy">
          </nz-range-picker>
        </div>
      </div>

      <div class="row d-none d-lg-flex">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <nz-table #sortTable [nzData]="filteredData" [nzLoading]="isLoadingData" nzSize="small">
                <thead>
                  <tr>
                    <th *ngFor="let col of listOfColumn" [nzSortFn]="col.compare">{{ col.title }}</th>
                    <th class="text-center">Detalhes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let data of sortTable.data">
                    <td>{{ data.documentDate | format: "date" }}</td>
                    <td>{{ (data.installments?.[0]?.dueDate) | format: "date" }}</td>
                    <td>{{ data.originDescription }}</td>
                    <td>{{ data.description }}</td>
                    <td>{{ data.personName }}</td>
                    <td>{{ data.categoryName }}</td>
                    <td>{{ data.totalAmount | format: "currency" }}</td>
                    <td class="text-danger fw-bold">{{ calculatePending(data) | format: "currency" }}</td>
                    <td>
                      <div class="row justify-content-center">
                        <div class="col-auto">
                          <button class="btn btn-sm btn-outline-primary" title="Visualizar Detalhes">
                            <i class="fa fa-list-dots" aria-hidden="true"></i>
                          </button>
                        </div>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </nz-table>
            </div>
          </div>
        </div>
      </div>

      <div class="row d-flex d-lg-none cards-mobile">
        <div class="col-12 mb-2" *ngFor="let item of filteredData">
          <div class="card pt-3">
            <div class="card-body">
              <div class="row">
                <div class="col-6 text-start">
                  <span class="card-label">Data</span><br>
                  <span>{{ item.documentDate | format: "date" }}</span>
                </div>
                <div class="col-6 text-end">
                  <span class="card-label">Valor</span><br>
                  <span class="fw-bold">{{ item.totalAmount | format: "currency" }}</span>
                </div>
                <div class="col-12"><hr></div>
                <div class="col-12 mb-2">
                  <span class="card-label">Pessoa:</span> {{ item.personName }}
                </div>
                <div class="col-12">
                  <span class="card-label">Descrição:</span> {{ item.description }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-new-financial-mov 
  *ngIf="newFinancialMoveVisible" 
  [isVisible]="newFinancialMoveVisible" 
  [movType]="1" 
  (close)="newFinancialMovStatusChange()" 
  (saved)="onCreatedFinancialmov($event)">
</app-new-financial-mov>